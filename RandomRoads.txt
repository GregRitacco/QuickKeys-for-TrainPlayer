** RandomRoads Version 2

Echo o2o Utility - Assign random road names and numbers to rolling stock

** Run the script


Input noteId $Set(@messageBundle, Get, 3)
Let inputData = $Note(@noteId)

Let message = $Set(@messageBundle, Get, 4)
Let toggleAll = $msgbox("YN", @message)

Echo Working on it......

Call NoteParser

If (@toggleAll = 1)
  Let allCarIds = $Layout(IDSet, CarIds)
EndIf
If (@toggleAll = 0)
  Let allCarIds = $Train($Train, CarIds)
EndIf

While ($Set(@allCarIds, Count) > 0)

  Let rsId = $String(@allCarIds, NextToken, ",")
  Let rsAar = $Car(@rsId, AAR)

** Relabel home equipment
  If ($Set(@RR21_HOME_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR40_HOME_LENGTH
    Let workingPool = @RR01_HOME_ROADS
    Let eqptNamesLen = $Set(@RR01_HOME_ROADS, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel pool equipment
  If ($Set(@RR22_MANIFEST_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR02_MANIFEST_POOL
    Let eqptNamesLen = $Set(@RR02_MANIFEST_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel passenger equipment
  If ($Set(@RR23_PASS_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR41_PASS_LENGTH
    Let workingPool = @RR01_HOME_ROADS
    Let eqptNamesLen = $Set(@RR01_HOME_ROADS, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel MOW equipment
  If ($Set(@RR24_MW_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR43_MW_LENGTH
    Let workingPool = @RR00_OPERATING_ROAD
    Let eqptNamesLen = $Set(@RR00_OPERATING_ROAD, Count) - 1
    Call RelabelRollingStock MoW
  EndIf

** Relabel reefer equipment
  If ($Set(@RR25_REEFER_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR03_REEFER_POOL
    Let eqptNamesLen = $Set(@RR03_REEFER_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel tank equipment
  If ($Set(@RR26_TANK_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR04_TANK_POOL
    Let eqptNamesLen = $Set(@RR04_TANK_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel hopper equipment
  If ($Set(@RR27_HOPPER_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR05_HOPPER_POOL
    Let eqptNamesLen = $Set(@RR05_HOPPER_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel special 1
  If ($Set(@RR28_SPECIAL_1_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR06_SPECIAL_1_Pool
    Let eqptNamesLen = $Set(@RR06_SPECIAL_1_Pool, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel special 2
  If ($Set(@RR29_SPECIAL_2_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR07_SPECIAL_2_POOL
    Let eqptNamesLen = $Set(@RR07_SPECIAL_2_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

** Relabel special 3
  If ($Set(@RR30_SPECIAL_3_AAR, Contains, @rsAar) = 1)
    Let roadNumberLength = @RR42_FREIGHT_LENGTH
    Let workingPool = @RR08_SPECIAL_3_POOL
    Let eqptNamesLen = $Set(@RR08_SPECIAL_3_POOL, Count) - 1
    Call RelabelRollingStock
  EndIf

EndWhile

Echo RandomRoads Version 2

*********************************************
Proc RandomNumber
** Generate a random road number

  Let result = ""

  Local length
  Let length = %1

  Local i
  Let i = 0
  While (@i < length)
    Let a = $Rand(0, 9)
    Let result = @a@@result
    Let i = @i + 1
  EndWhile

EndProc
*********************************************

Proc RelabelRollingStock
** Relabel the rolling stock with the randomly generated road and number.
** For now seperator is hard coded as whitespace.
** SUFFIX can be something like '-MoW' but NOT a number.

  Let SEPERATOR = " "
  Let SUFFIX = %1
  Let randomRoadIndex = $Rand(0, @eqptNamesLen)
  Let randomRoad = $Set(@workingPool, Get, @randomRoadIndex)
  Call RandomNumber @roadNumberLength
  Let $Car(@rsId, Label) = @randomRoad@@SUFFIX@@SEPERATOR@@result

EndProc
*********************************************

Proc NoteParser

Call $String(@inputData, NextToken, @xCR)

** Get the road name sets for equipment types

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR00_OPERATING_ROAD = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR01_HOME_ROADS = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR02_MANIFEST_POOL = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR03_REEFER_POOL = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR04_TANK_POOL = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR05_HOPPER_POOL = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR06_SPECIAL_1_Pool = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR07_SPECIAL_2_Pool = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR08_SPECIAL_3_Pool = @x

** Get the AAR sets for each equipment type

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR20_OPERATING_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR21_HOME_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR22_MANIFEST_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR23_PASS_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR24_MW_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR25_REEFER_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR26_TANK_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR27_HOPPER_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR28_SPECIAL_1_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR29_SPECIAL_2_AAR = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR30_SPECIAL_3_AAR = @x

** Get the equipmant number lengths

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR40_HOME_LENGTH = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR41_PASS_LENGTH = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR42_FREIGHT_LENGTH = @x

  Let x = $String(@inputData, NextToken, @xCR)
  Call $String(@x, NextToken, " ")
  Let RR43_MW_LENGTH = @x

EndProc
*********************************************
